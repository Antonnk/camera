<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <title>Camera Examples</title>
    <script src="/scripts/force-https.js"></script>
    <link rel="stylesheet" href="/style.css"/>
  </head>
  <body>
    <ul id='readout'>
    </ul>
    <script>
    let readout = document.getElementById('readout');

    navigator.mediaDevices.getUserMedia({video: true})
      .then(mediaStream => {
        let tracks = mediaStream.getVideoTracks();
        if (!tracks.length) {
          let li = document.createElement('li');
          li.innerHTML = "no camera";
          readout.appendChild(li);
        } else {
          tracks.forEach(track => {
            let li = document.createElement('li');
            li.innerHTML = JSON.stringify({
              label: track.label,
              readyState: track.readyState,
              enabled: track.enabled,
              muted: track.muted,
              id: track.id,
              kind: track.kind,
            });

            let cap = track.getCapabilities();
            console.log(cap);

            let imageCapture = new ImageCapture(track);
            imageCapture.getPhotoCapabilities()
              .then((caps) => {
                let s1 = document.createElement('div');
                s1.innerHTML = 'Photo capabilities: ' + JSON.stringify({
                  fillLightMode: JSON.stringify(caps.fillLightMode),
                  imageHeight: {
                    max: caps.imageHeight.max,
                    min: caps.imageHeight.min,
                    step: caps.imageHeight.step
                  },
                  imageWidth: {
                    max: caps.imageWidth.max,
                    min: caps.imageWidth.min,
                    step: caps.imageWidth.step
                  },
                  redEyeReduction: caps.redEyeReduction
                });
                li.appendChild(s1);
              })
              .then((photoSettings) => {
                let s2 = document.createElement('div');
                s2.innerHTML = 'Photo Settings: ' + JSON.stringify(photoSettings);
                li.appendChild(s2);
              })
              .catch(error => console.error('Error getting camera capabilities and settings:', error));

            readout.appendChild(li);
          });
        }
      })
      .catch(err => {
        let li = document.createElement('li');
        li.innerHTML = "standard camera: " + err.name + ": " + err.message;
        readout.appendChild(li);
      });

    navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } } })
    .then(mediaStream => {
      let tracks = mediaStream.getVideoTracks();
      if (!tracks.length) {
        let li = document.createElement('li');
        li.innerHTML = "no environment camera";
        readout.appendChild(li);
      } else {
        tracks.forEach(track => {
          let li = document.createElement('li');
          li.innerHTML = JSON.stringify({
            label: track.label,
            readyState: track.readyState,
            enabled: track.enabled,
            muted: track.muted,
            id: track.id,
            kind: track.kind,
          });
          readout.appendChild(li);
        });
      }
    })
    .catch(err => {
      let li = document.createElement('li');
      li.innerHTML = "environment camera: " + err.name + ": " + err.message;
      readout.appendChild(li);
    });

    </script>
  </body>
</html>
